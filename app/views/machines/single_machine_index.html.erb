<% content_for :title, "Cloud - #{current_user_name} -Single Machine List" %>
	<div class = "pannel-group" id = "accordion">
		<h2>Machine List</h2>
		<% @user_vm_list.each do |vm| %>
			<% vm_detail = VmType.find(vm["vm_type"]) %>
			<%= form_tag( single_machines_handle_action_path, method: :post) do %>
				<%= hidden_field_tag :vm_id, vm["vm_id"] %>
				<div id = "collapsesState<%= vm['vm_id']%>" class="panel panel-default">
					<div class="panel-heading" style = "height: 54px;">
						<div class="panel-title">
							<a class="accordion-toggle" data-toggle="collapse" href="#id collapse">
								 <i class="fa fa-angle-double-down fa-1x"></i> VMS name: <%= vm_detail["name"] %>
							</a>
							<div class="pull-right">
								<% if (vm['state'] == '1') %>Running <% end %>
								<% if (vm['state'] == '0') %>Stoped <% end %>
								<% if (vm['state'] == '2') %>Hibernate <% end %>
								<button id="" class = "btn btn-success" data-toggle="modal" data-target="#choose-iso-<%= vm['vm_id'] %>">Start</button>
								<input type="submit" value="Hibernate" id="" name="commit" class="btn btn-warning"/>
								<input type="submit" value="Stop" id="" name="commit" class="btn btn-danger"/>
								
							</div>
						</div>
					</div>
					<div id="collapsesState<%= vm['vm_id']%>" class="panel-collapse collapse in">
						<div class="panel-body">
							<div class = "row-fluid">
								<div class = "col-md-8" style = "padding-top: 16px;">
									<ul>
										<li>Ram: <%= vm_detail["ram"] %></li>
										<li>CPU: <%= vm_detail["cpus"] %> core</li>
										<li>Storage: 100 GB</li>
										<li>State: <%= vm["state"] %></li>
									</ul>
									<!-- show list iso -->
									<div class="modal fade" id="choose-iso-<%= vm['vm_id'] %>" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
									  <div class="modal-dialog">
									    <div class="modal-content">
									      <div class="modal-header">
									        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
									        <h4 class="modal-title" id="myModalLabel">Choose Iso</h4>
									      </div>
									      <div class="modal-body">
									      	<select name = "iso_id" class = "selectpicker">
														<% @iso_list.each do |iso| %>
															<option value = "<%= iso['iso_id']%>"> <%= iso['iso_name']%></option>
														<% end %>
													</select>
									      </div>
									      <div class="modal-footer">
									        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
									        <%= submit_tag "Start", class: "btn btn-primary" %>
									      </div>
									    </div><!-- /.modal-content -->
									  </div><!-- /.modal-dialog -->
									</div><!-- /.modal -->
								</div>
							</div>

						</div>
					</div>
				</div>
			<% end %>
		<% end %>
	</div>	
<script type="text/javascript" charset="utf-8">
	$(document).ready(function(){
		<% @user_vm_list.each do |m| %>
			if (<%= m['state'] %> == 0){
				$('#collapsesState<%= m['vm_id']%>').removeClass('panel panel-default').addClass('panel panel-danger');
				$('#stop<%= m['vm_id']%>').attr('disabled','disabled');
			} else if (<%= m['state'] %> == 1) {
				$('#collapsesState<%= m['vm_id']%>').removeClass('panel panel-default').addClass('panel panel-success');
				$('#start<%= m['vm_id']%>').attr('disabled','disabled');
			} else if (<%= m['state'] %> == 2) {
				$('#collapsesState<%= m['vm_id']%>').removeClass('panel panel-default').addClass('panel panel-warning');
				$('#start<%= m['vm_id']%>').attr('disabled','disabled');
				$('#stop<%= m['vm_id']%>').attr('disabled','disabled');
			}
		<% end %>
</script>